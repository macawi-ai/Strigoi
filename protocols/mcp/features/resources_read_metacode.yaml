# Feature Metacode: resources/read
# DATA_ACCESS class - Medium risk with modifiers

feature:
  id: mcp_resources_read
  white_hat_permitted: YES  # With strict constraints

operation:
  action: SEND_REQUEST
  protocol: JSON_RPC_2.0
  method: "resources/read"
  
  parameters:
    required:
      - name: uri
        type: STRING
        purpose: RESOURCE_IDENTIFIER

constraints:
  rate_limit:
    max: 5
    window: MINUTE
  timeout: 3_SECONDS
  retry: FORBIDDEN

validation_rules:
  
  # From ontology: path_traversal_prevention
  - rule: BLOCK_PATH_TRAVERSAL
    check:
      field: request.params.uri
      must_not_contain:
        - "../"
        - "..\\"
        - "%2e%2e"
        - "%252e%252e"
        - "..%c0%af"
        - "..%c1%9c"
    severity: CRITICAL
    
  # From ontology: authorization_validation  
  - rule: VERIFY_ACCESS_BOUNDARY
    check:
      field: response.result.contents
      must_not_reveal:
        - "/etc/passwd"
        - "C:\\Windows\\System32"
        - ".env"
        - "config.json"
        - "*.key"
        - "*.pem"
    severity: CRITICAL
    
  # From ontology: injection_resistance
  - rule: URI_INJECTION_PREVENTION
    check:
      field: request.params.uri
      must_not_match:
        - "file:///etc/*"
        - "http://169.254.*"  # AWS metadata
        - "http://metadata.*"
        - "gopher://*"
        - "dict://*"
    severity: HIGH
    
  # From ontology: data_leakage_assessment
  - rule: SENSITIVE_DATA_DETECTION
    check:
      field: response.result.contents
      scan_for:
        - pattern: "password.*=.*"
        - pattern: "api[_-]key.*=.*"
        - pattern: "BEGIN.*PRIVATE KEY"
        - pattern: "aws_access_key_id"
    severity: SECURITY_FINDING

behavior_constraints:
  
  - constraint: READ_ONLY_ACCESS
    forbidden_actions:
      - WRITE_TO_RESOURCE
      - DELETE_RESOURCE
      - EXECUTE_RESOURCE
      
  - constraint: RESPECT_BOUNDARIES
    test_uris:
      allowed:
        - "test://sample.txt"
        - "demo://public/file"
      forbidden:
        - "file:///etc/passwd"
        - "../../secret.key"
        
  - constraint: SIZE_LIMITS
    max_response_size: 10MB
    abort_on_timeout: true

test_sequence:
  1_SAFE_ENUMERATION:
    - LIST_AVAILABLE_RESOURCES
    - CHECK_RESOURCE_SCHEMAS
    - IDENTIFY_URI_PATTERNS
    
  2_BOUNDARY_TESTING:
    - VALID_RESOURCE_ACCESS
    - NONEXISTENT_RESOURCE
    - MALFORMED_URI
    
  3_SECURITY_TESTING:
    - PATH_TRAVERSAL_ATTEMPTS
    - PROTOCOL_CONFUSION
    - METADATA_ENDPOINT_PROBE
    - LARGE_FILE_DOS
    
  4_DATA_ANALYSIS:
    - SCAN_FOR_CREDENTIALS
    - CHECK_FOR_PII
    - IDENTIFY_CONFIG_LEAKS

risk_calculation:
  base: MEDIUM  # DATA_ACCESS class
  
  modifiers_detected:
    - check: "no_authentication"
      if_true: "multiply by 3.0"
    - check: "path_traversal_possible"  
      if_true: "multiply by 5.0"
    - check: "accesses_user_data"
      if_true: "multiply by 2.0"
      
  test_failure_impacts:
    - path_traversal: CRITICAL (+40)
    - credential_leak: HIGH (+20)
    - metadata_access: CRITICAL (+40)