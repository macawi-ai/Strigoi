# Attack Vector: Token and Credential Exploitation in MCP

## Attack Overview
MCP servers often store OAuth tokens, API keys, and other credentials to access external services. These credentials become high-value targets as they can be exfiltrated and reused by attackers to create rogue MCP servers or directly access victim services.

## Communication Flow Diagram

```
[Attack Scenario: MCP Server Token Storage Exploitation]

┌─────────────────────────── Normal Operation ───────────────────────────┐
│                                                                         │
│  ┌─────────────┐         ┌──────────────┐         ┌──────────────┐   │
│  │   Claude    │ STDIO   │  MCP Server  │  HTTPS  │   Gmail      │   │
│  │   Client    │ ←─────→ │   (local)    │ ←─────→ │   API        │   │
│  └─────────────┘         └──────────────┘         └──────────────┘   │
│                                 |                                      │
│                                 | Stores OAuth token                   │
│                                 ↓                                      │
│                          ┌──────────────┐                             │
│                          │ ~/.mcp/creds │                             │
│                          │ gmail_token: │                             │
│                          │ "ya29.a0..."  │                             │
│                          └──────────────┘                             │
└─────────────────────────────────────────────────────────────────────┘

┌─────────────────────────── Attack Phase 1: Token Theft ────────────────┐
│                                                                         │
│  ┌─────────────┐         ┌──────────────┐                            │
│  │  Attacker   │ ←─────→ │ Compromised  │                            │
│  │             │  Exploit │ MCP Server   │                            │
│  └─────────────┘         └──────────────┘                            │
│         |                        |                                     │
│         | Exfiltrates            | Reads                              │
│         | credentials            ↓                                     │
│         |                 ┌──────────────┐                           │
│         └────────────────→│ ~/.mcp/creds │                           │
│                          │ gmail_token   │                           │
│                          └──────────────┘                           │
└─────────────────────────────────────────────────────────────────────┘

┌─────────────────────── Attack Phase 2: Token Reuse ────────────────────┐
│                                                                         │
│  ┌─────────────┐         ┌──────────────┐         ┌──────────────┐   │
│  │  Attacker   │ STDIO   │ Rogue MCP    │  HTTPS  │   Gmail      │   │
│  │  Client     │ ←─────→ │   Server     │ ←─────→ │   API        │   │
│  └─────────────┘         └──────────────┘         └──────────────┘   │
│                                 |                         |             │
│                                 | Uses stolen token       |             │
│                                 | "ya29.a0..."           |             │
│                                 └─────────────────────────┘             │
│                                                                         │
│                          Full access to victim's Gmail                  │
└─────────────────────────────────────────────────────────────────────┘
```

## Attack Layers

### Layer 1: Credential Storage
- **Location**: Various storage mechanisms
  - Plain text files: `~/.mcp/credentials.json`
  - Environment variables: `$MCP_GMAIL_TOKEN`
  - System keychain/credential manager
  - In-memory storage
- **Vulnerability**: Often stored with weak or no encryption
- **Access**: Any process with user privileges can read

### Layer 2: Credential Theft Vectors
- **Direct file access**: Reading credential files
- **Memory dumping**: Extracting tokens from MCP server memory
- **Environment inspection**: Reading process environment
- **MCP tool abuse**: Using MCP's own tools to read config files
- **Log file leakage**: Tokens accidentally logged in debug mode

### Layer 3: Credential Reuse
- **Rogue MCP servers**: Attacker creates malicious MCP server with stolen tokens
- **Direct API access**: Bypass MCP entirely, use tokens directly
- **Lateral movement**: One compromised token leads to others
- **Persistence**: Long-lived tokens provide persistent access

## Example Attack Scenarios

### 1. Configuration File Raid
```bash
# Attacker uses MCP's own tools against it
claude> "Use MCP to rea